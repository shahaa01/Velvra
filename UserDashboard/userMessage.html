<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velvra - Messages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'charcoal': '#1a1a1a',
                        'gold': '#d4af37',
                        'cream': '#f8f6f0',
                        'pearl': '#fefcf7',
                        'beige': '#e8dcc6',
                        'stone': '#a8a196',
                        'brand': '#f8e9d3',
                        'velvra-gold-dark': '#B8941F',
                        'velvra-gold-light': '#E5C547'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .brand-font {
            font-family: 'Playfair Display', serif;
        }
        
        .nav-link {
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background-color: rgba(212, 175, 55, 0.1);
        }
        
        .nav-link.active {
            background-color: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            border-left: 3px solid #d4af37;
        }
        
        .message-thread {
            transition: all 0.3s ease;
        }
        
        .message-thread:hover {
            background-color: rgba(212, 175, 55, 0.05);
        }
        
        .message-thread.active {
            background-color: rgba(212, 175, 55, 0.1);
            border-left: 3px solid #d4af37;
        }
        
        .mobile-nav-item {
            transition: all 0.3s ease;
        }
        
        .mobile-nav-item.active {
            color: #d4af37;
        }
        
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #a8a196;
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f8f6f0;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #B8941F;
        }
        
        @media (max-width: 768px) {
            .nav-link.active {
                border-left: none;
                border-bottom: 3px solid #d4af37;
            }
        }
        /* Mobile full-screen messaging */
@media (max-width: 1024px) {
    .mobile-messages-fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 60;
        background: #fefcf7;
        transform: translateX(100%);
        transition: transform 0.3s ease;
    }
    
    .mobile-messages-fullscreen.active {
        transform: translateX(0);
    }
    
    .mobile-conversation-header {
        background: #f8f6f0;
        border-bottom: 1px solid #e8dcc6;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .mobile-back-btn {
        color: #d4af37;
        font-size: 1.25rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: background-color 0.2s ease;
    }
    
    .mobile-back-btn:hover {
        background: rgba(212, 175, 55, 0.1);
    }
}
    </style>
</head>
<body class="bg-pearl">
    <!-- Header -->
    <header class="bg-cream border-b border-beige sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button id="menuToggle" class="lg:hidden text-charcoal">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gold brand-font">Velvra</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="relative p-2 text-stone hover:text-charcoal transition-colors">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                    </button>
                    <button class="p-2 text-stone hover:text-charcoal transition-colors">
                        <i class="fas fa-shopping-cart text-xl"></i>
                    </button>
                    <img src="https://ui-avatars.com/api/?name=Emma+Johnson&background=d4af37&color=1a1a1a" 
                         alt="Profile" 
                         class="w-8 h-8 rounded-full cursor-pointer">
                </div>
            </div>
        </div>
    </header>

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="fixed lg:static lg:translate-x-0 -translate-x-full top-0 left-0 z-50 w-64 h-full bg-cream border-r border-beige transition-transform duration-300 pt-16 lg:pt-0">
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="dashboard.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-stone hover:text-charcoal">
                            <i class="fas fa-home w-5"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="orders.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-stone hover:text-charcoal">
                            <i class="fas fa-shopping-bag w-5"></i>
                            <span>My Orders</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link active flex items-center space-x-3 px-4 py-3 rounded-lg text-charcoal">
                            <i class="fas fa-envelope w-5"></i>
                            <span>Messages</span>
                            <span class="ml-auto bg-gold text-charcoal text-xs px-2 py-1 rounded-full">3</span>
                        </a>
                    </li>
                    <li>
                        <a href="issues.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-stone hover:text-charcoal">
                            <i class="fas fa-exclamation-circle w-5"></i>
                            <span>Report Issues</span>
                        </a>
                    </li>
                    <li>
                        <a href="wishlist.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-stone hover:text-charcoal">
                            <i class="fas fa-heart w-5"></i>
                            <span>Wishlist</span>
                            <span class="ml-auto bg-stone text-white text-xs px-2 py-1 rounded-full">12</span>
                        </a>
                    </li>
                    <li>
                        <a href="profile.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-stone hover:text-charcoal">
                            <i class="fas fa-user-circle w-5"></i>
                            <span>Profile Settings</span>
                        </a>
                    </li>
                    <li class="pt-4 border-t border-beige">
                        <button id="logoutBtn" class="nav-link w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-stone hover:text-red-600">
                            <i class="fas fa-sign-out-alt w-5"></i>
                            <span>Log Out</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8">
            <!-- Page Header -->
            <div class="mb-6">
                <h2 class="text-2xl sm:text-3xl font-semibold text-charcoal mb-2">Messages</h2>
                <p class="text-stone">Communicate with sellers about your orders</p>
            </div>

            <!-- Messages Layout -->
<!-- Messages Layout -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Message Threads List -->
    <div class="lg:col-span-1">
        <div class="bg-cream rounded-xl border border-beige">
            <div class="p-4 border-b border-beige">
                <h3 class="font-semibold text-charcoal">Conversations</h3>
            </div>
            
            <div id="threadsList" class="divide-y divide-beige max-h-[600px] overflow-y-auto">
                <!-- Threads will be populated by JavaScript -->
            </div>
            
            <!-- Empty State -->
            <div id="emptyThreads" class="hidden p-8 text-center">
                <i class="fas fa-comments text-4xl text-stone mb-3"></i>
                <p class="text-stone">No conversations yet</p>
                <p class="text-sm text-stone mt-1">Messages from sellers will appear here</p>
            </div>
        </div>
    </div>

    <!-- Desktop Message Content -->
    <div class="lg:col-span-2 hidden lg:block">
        <div class="bg-cream rounded-xl border border-beige h-[600px] flex flex-col">
            <!-- Default State -->
            <div id="defaultState" class="flex-1 flex items-center justify-center p-8 text-center">
                <div>
                    <i class="fas fa-envelope-open text-5xl text-stone mb-4"></i>
                    <p class="text-stone font-medium">Select a conversation</p>
                    <p class="text-sm text-stone mt-1">Choose a message thread to view the conversation</p>
                </div>
            </div>

            <!-- Active Conversation -->
            <div id="activeConversation" class="hidden flex flex-col h-full">
                <!-- Conversation Header -->
                <div class="p-4 border-b border-beige">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <img id="sellerAvatar" src="" alt="Seller" class="w-10 h-10 rounded-full">
                            <div>
                                <h3 id="sellerName" class="font-semibold text-charcoal"></h3>
                                <p id="orderInfo" class="text-sm text-stone"></p>
                            </div>
                        </div>
                        <button id="moreOptions" class="p-2 text-stone hover:text-charcoal transition-colors">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messagesContainer" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <!-- Messages will be populated by JavaScript -->
                </div>

                <!-- Reply Box -->
                <div class="p-4 border-t border-beige">
                    <div class="flex items-end space-x-2">
                        <textarea id="replyInput" 
                                  placeholder="Type your message..." 
                                  class="flex-1 px-4 py-3 bg-pearl border border-beige rounded-lg focus:outline-none focus:border-gold resize-none"
                                  rows="2"></textarea>
                        <button id="sendBtn" class="px-4 py-3 bg-gold text-charcoal rounded-lg hover:bg-velvra-gold-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Full-Screen Message Content -->
<div id="mobileMessages" class="mobile-messages-fullscreen">
    <!-- Mobile Conversation Header -->
    <div class="mobile-conversation-header">
        <button id="mobileBackBtn" class="mobile-back-btn">
            <i class="fas fa-arrow-left"></i>
        </button>
        <img id="mobileSellerAvatar" src="" alt="Seller" class="w-10 h-10 rounded-full">
        <div class="flex-1">
            <h3 id="mobileSellerName" class="font-semibold text-charcoal"></h3>
            <p id="mobileOrderInfo" class="text-sm text-stone"></p>
        </div>
        <button id="mobileMoreOptions" class="p-2 text-stone hover:text-charcoal transition-colors">
            <i class="fas fa-ellipsis-v"></i>
        </button>
    </div>

    <!-- Mobile Messages Container -->
    <div id="mobileMessagesContainer" class="flex-1 overflow-y-auto p-4 space-y-4 pb-24">
        <!-- Messages will be populated by JavaScript -->
    </div>

    <!-- Mobile Reply Box -->
    <div class="fixed bottom-16 left-0 right-0 p-4 bg-pearl border-t border-beige">
        <div class="flex items-end space-x-2">
            <textarea id="mobileReplyInput" 
                      placeholder="Type your message..." 
                      class="flex-1 px-4 py-3 bg-white border border-beige rounded-lg focus:outline-none focus:border-gold resize-none"
                      rows="1"></textarea>
            <button id="mobileSendBtn" class="px-4 py-3 bg-gold text-charcoal rounded-lg hover:bg-velvra-gold-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>
        </main>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-cream border-t border-beige z-40">
        <div class="grid grid-cols-5 gap-1">
            <a href="dashboard.html" class="mobile-nav-item flex flex-col items-center py-2 text-xs text-stone">
                <i class="fas fa-home text-lg mb-1"></i>
                <span>Home</span>
            </a>
            <a href="orders.html" class="mobile-nav-item flex flex-col items-center py-2 text-xs text-stone">
                <i class="fas fa-shopping-bag text-lg mb-1"></i>
                <span>Orders</span>
            </a>
            <a href="wishlist.html" class="mobile-nav-item flex flex-col items-center py-2 text-xs text-stone">
                <i class="fas fa-heart text-lg mb-1"></i>
                <span>Wishlist</span>
            </a>
            <a href="#" class="mobile-nav-item active flex flex-col items-center py-2 text-xs relative">
                <i class="fas fa-envelope text-lg mb-1"></i>
                <span>Messages</span>
                <span class="absolute top-0 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
            </a>
            <a href="profile.html" class="mobile-nav-item flex flex-col items-center py-2 text-xs text-stone">
                <i class="fas fa-user text-lg mb-1"></i>
                <span>Profile</span>
            </a>
        </div>
    </nav>

    <!-- Logout Modal -->
    <div id="logoutModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-cream rounded-xl p-6 max-w-sm w-full">
            <h3 class="text-lg font-semibold text-charcoal mb-4">Confirm Logout</h3>
            <p class="text-stone mb-6">Are you sure you want to log out of your account?</p>
            <div class="flex space-x-3">
                <button id="cancelLogout" class="flex-1 px-4 py-2 bg-pearl border border-beige rounded-lg text-stone hover:bg-cream transition-colors">
                    Cancel
                </button>
                <button id="confirmLogout" class="flex-1 px-4 py-2 bg-gold text-charcoal rounded-lg hover:bg-velvra-gold-dark transition-colors">
                    Log Out
                </button>
            </div>
        </div>
    </div>

    <!-- Success Notification -->
    <div id="notification" class="fixed bottom-20 lg:bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-full transition-transform duration-300 z-50">
        <div class="flex items-center gap-2">
            <i class="fas fa-check-circle"></i>
            <span id="notificationText">Message sent!</span>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>

    <script>
        // Sample messages data
        const messagesData = [
            {
                id: 1,
                seller: "Fashion Hub",
                sellerAvatar: "https://ui-avatars.com/api/?name=Fashion+Hub&background=d4af37&color=1a1a1a",
                orderId: "12345",
                product: "Leather Jacket",
                unread: 2,
                lastMessage: "Your order has been shipped!",
                lastMessageTime: new Date(Date.now() - 2 * 60 * 60 * 1000),
                messages: [
                    {
                        sender: "seller",
                        content: "Hello Emma! Thank you for your order. We're preparing your leather jacket for shipment.",
                        timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000)
                    },
                    {
                        sender: "buyer",
                        content: "Great! When can I expect it to ship?",
                        timestamp: new Date(Date.now() - 20 * 60 * 60 * 1000)
                    },
                    {
                        sender: "seller",
                        content: "Your order has been shipped! Here's your tracking number: 1Z999AA10123456784",
                        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000)
                    }
                ]
            },
            {
                id: 2,
                seller: "Elegant Boutique",
                sellerAvatar: "https://ui-avatars.com/api/?name=Elegant+Boutique&background=a8a196&color=ffffff",
                orderId: "12344",
                product: "Silk Dress",
                unread: 1,
                lastMessage: "Thank you for your patience. Your dress is on its way!",
                lastMessageTime: new Date(Date.now() - 5 * 60 * 60 * 1000),
                messages: [
                    {
                        sender: "buyer",
                        content: "Hi, I ordered a silk dress 2 days ago. When will it ship?",
                        timestamp: new Date(Date.now() - 48 * 60 * 60 * 1000)
                    },
                    {
                        sender: "seller",
                        content: "Hello! Your dress is being carefully packaged. It will ship tomorrow.",
                        timestamp: new Date(Date.now() - 40 * 60 * 60 * 1000)
                    },
                    {
                        sender: "seller",
                        content: "Thank you for your patience. Your dress is on its way!",
                        timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000)
                    }
                ]
            },
            {
                id: 3,
                seller: "Luxury Goods Co.",
                sellerAvatar: "https://ui-avatars.com/api/?name=Luxury+Goods&background=1a1a1a&color=d4af37",
                orderId: "12343",
                product: "Designer Handbag",
                unread: 0,
                lastMessage: "We'll update you as soon as your item is ready to ship.",
                lastMessageTime: new Date(Date.now() - 72 * 60 * 60 * 1000),
                messages: [
                    {
                        sender: "seller",
                        content: "Thank you for choosing our designer handbag! We're currently processing your order.",
                        timestamp: new Date(Date.now() - 72 * 60 * 60 * 1000)
                    },
                    {
                        sender: "buyer",
                        content: "Looking forward to receiving it! Do you have an estimated shipping date?",
                        timestamp: new Date(Date.now() - 70 * 60 * 60 * 1000)
                    },
                    {
                        sender: "seller",
                        content: "We'll update you as soon as your item is ready to ship.",
                        timestamp: new Date(Date.now() - 69 * 60 * 60 * 1000)
                    }
                ]
            }
        ];

        // State management
        let selectedThreadId = null;

        // DOM elements
        const threadsList = document.getElementById('threadsList');
        const emptyThreads = document.getElementById('emptyThreads');
        const defaultState = document.getElementById('defaultState');
        const activeConversation = document.getElementById('activeConversation');
        const messagesContainer = document.getElementById('messagesContainer');
        const replyInput = document.getElementById('replyInput');
        const sendBtn = document.getElementById('sendBtn');
        const notification = document.getElementById('notification');
        const logoutModal = document.getElementById('logoutModal');

        // Mobile menu
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // Render threads list
        function renderThreads() {
            if (messagesData.length === 0) {
                threadsList.classList.add('hidden');
                emptyThreads.classList.remove('hidden');
                return;
            }

            threadsList.classList.remove('hidden');
            emptyThreads.classList.add('hidden');

            threadsList.innerHTML = messagesData.map(thread => `
                <div class="message-thread p-4 cursor-pointer ${thread.id === selectedThreadId ? 'active' : ''}" 
                     onclick="selectThread(${thread.id})">
                    <div class="flex items-start space-x-3">
                        <img src="${thread.sellerAvatar}" alt="${thread.seller}" class="w-10 h-10 rounded-full">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between">
                                <h4 class="font-medium text-charcoal truncate">${thread.seller}</h4>
                                <span class="text-xs text-stone ml-2">${formatTime(thread.lastMessageTime)}</span>
                            </div>
                            <p class="text-sm text-stone mt-1">Order #${thread.orderId} - ${thread.product}</p>
                            <p class="text-sm text-stone mt-1 truncate">${thread.lastMessage}</p>
                        </div>
                        ${thread.unread > 0 ? `
                            <span class="bg-gold text-charcoal text-xs px-2 py-1 rounded-full">${thread.unread}</span>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Select thread
// Select thread
function selectThread(threadId) {
    selectedThreadId = threadId;
    const thread = messagesData.find(t => t.id === threadId);
    
    if (!thread) return;

    // Mark as read
    thread.unread = 0;
    renderThreads();
    updateUnreadCount();

    // Check if mobile
    const isMobile = window.innerWidth < 1024;
    
    if (isMobile) {
        // Show mobile full-screen conversation
        document.getElementById('mobileMessages').classList.add('active');
        
        // Update mobile header
        document.getElementById('mobileSellerAvatar').src = thread.sellerAvatar;
        document.getElementById('mobileSellerName').textContent = thread.seller;
        document.getElementById('mobileOrderInfo').textContent = `Order #${thread.orderId} - ${thread.product}`;
        
        // Render mobile messages
        renderMobileMessages(thread);
    } else {
        // Show desktop conversation
        defaultState.classList.add('hidden');
        activeConversation.classList.remove('hidden');

        // Update desktop header
        document.getElementById('sellerAvatar').src = thread.sellerAvatar;
        document.getElementById('sellerName').textContent = thread.seller;
        document.getElementById('orderInfo').textContent = `Order #${thread.orderId} - ${thread.product}`;

        // Render desktop messages
        renderMessages(thread);
    }
}

        // Render messages
        function renderMessages(thread) {
            messagesContainer.innerHTML = thread.messages.map(msg => `
                <div class="flex ${msg.sender === 'buyer' ? 'justify-end' : 'justify-start'} fade-in">
                    <div class="max-w-xs sm:max-w-md">
                        <div class="${msg.sender === 'buyer' 
                            ? 'bg-gold text-charcoal rounded-lg rounded-br-none' 
                            : 'bg-white text-charcoal rounded-lg rounded-bl-none'} 
                            px-4 py-3 shadow-sm">
                            <p class="text-sm">${msg.content}</p>
                        </div>
                        <p class="text-xs text-stone mt-1 ${msg.sender === 'buyer' ? 'text-right' : ''}">${formatTime(msg.timestamp)}</p>
                    </div>
                </div>
            `).join('');

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Render mobile messages
function renderMobileMessages(thread) {
    const mobileContainer = document.getElementById('mobileMessagesContainer');
    mobileContainer.innerHTML = thread.messages.map(msg => `
        <div class="flex ${msg.sender === 'buyer' ? 'justify-end' : 'justify-start'} fade-in">
            <div class="max-w-xs sm:max-w-md">
                <div class="${msg.sender === 'buyer' 
                    ? 'bg-gold text-charcoal rounded-lg rounded-br-none' 
                    : 'bg-white text-charcoal rounded-lg rounded-bl-none'} 
                    px-4 py-3 shadow-sm">
                    <p class="text-sm">${msg.content}</p>
                </div>
                <p class="text-xs text-stone mt-1 ${msg.sender === 'buyer' ? 'text-right' : ''}">${formatTime(msg.timestamp)}</p>
            </div>
        </div>
    `).join('');

    // Scroll to bottom
    mobileContainer.scrollTop = mobileContainer.scrollHeight;
}

// Mobile back button functionality
document.getElementById('mobileBackBtn').addEventListener('click', () => {
    document.getElementById('mobileMessages').classList.remove('active');
    selectedThreadId = null;
});

// Mobile message sending
const mobileReplyInput = document.getElementById('mobileReplyInput');
const mobileSendBtn = document.getElementById('mobileSendBtn');

mobileReplyInput.addEventListener('input', () => {
    mobileSendBtn.disabled = !mobileReplyInput.value.trim();
});

mobileReplyInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMobileMessage();
    }
});

mobileSendBtn.addEventListener('click', sendMobileMessage);

function sendMobileMessage() {
    const content = mobileReplyInput.value.trim();
    if (!content || !selectedThreadId) return;

    const thread = messagesData.find(t => t.id === selectedThreadId);
    if (!thread) return;

    // Add message
    const newMessage = {
        sender: 'buyer',
        content: content,
        timestamp: new Date()
    };
    
    thread.messages.push(newMessage);
    thread.lastMessage = content;
    thread.lastMessageTime = new Date();

    // Clear input
    mobileReplyInput.value = '';
    mobileSendBtn.disabled = true;

    // Re-render
    renderMobileMessages(thread);
    renderThreads();

    // Show notification
    showNotification('Message sent!');

    // Simulate seller typing and response
    simulateSellerResponse(thread);
}

        // Send message
        replyInput.addEventListener('input', () => {
            sendBtn.disabled = !replyInput.value.trim();
        });

        replyInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendBtn.addEventListener('click', sendMessage);

        function sendMessage() {
            const content = replyInput.value.trim();
            if (!content || !selectedThreadId) return;

            const thread = messagesData.find(t => t.id === selectedThreadId);
            if (!thread) return;

            // Add message
            const newMessage = {
                sender: 'buyer',
                content: content,
                timestamp: new Date()
            };
            
            thread.messages.push(newMessage);
            thread.lastMessage = content;
            thread.lastMessageTime = new Date();

            // Clear input
            replyInput.value = '';
            sendBtn.disabled = true;

            // Re-render
            renderMessages(thread);
            renderThreads();

            // Show notification
            showNotification('Message sent!');

            // Simulate seller typing and response
            simulateSellerResponse(thread);
        }

        // Simulate seller response
        function simulateSellerResponse(thread) {
            // Show typing indicator
            setTimeout(() => {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'flex justify-start fade-in';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = `
                    <div class="bg-white rounded-lg px-4 py-3 shadow-sm">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1000);

            // Send response
            setTimeout(() => {
                // Remove typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) typingIndicator.remove();

                // Add response
                const responses = [
                    "Thank you for your message! I'll look into this right away.",
                    "I appreciate you reaching out. Let me check on that for you.",
                    "Thanks for getting in touch! I'll update you shortly.",
                    "I understand your concern. Let me help you with that."
                ];
                
                const response = {
                    sender: 'seller',
                    content: responses[Math.floor(Math.random() * responses.length)],
                    timestamp: new Date()
                };
                
                thread.messages.push(response);
                thread.lastMessage = response.content;
                thread.lastMessageTime = new Date();
                thread.unread = 1;

                renderMessages(thread);
                renderThreads();
                updateUnreadCount();
            }, 3000);
        }

        // Update unread count
        function updateUnreadCount() {
            const totalUnread = messagesData.reduce((sum, thread) => sum + thread.unread, 0);
            const badges = document.querySelectorAll('.nav-link .bg-gold, .mobile-nav-item .bg-red-500');
            
            badges.forEach(badge => {
                if (badge.classList.contains('bg-gold')) {
                    badge.textContent = totalUnread || '0';
                    badge.style.display = totalUnread ? 'inline-block' : 'none';
                }
            });
        }

        // Logout modal
        document.getElementById('logoutBtn').addEventListener('click', () => {
            logoutModal.classList.remove('hidden');
        });

        document.getElementById('cancelLogout').addEventListener('click', () => {
            logoutModal.classList.add('hidden');
        });

        document.getElementById('confirmLogout').addEventListener('click', () => {
            window.location.href = '#logged-out';
        });

        // Utility functions
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        function showNotification(message) {
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            notification.style.transform = 'translateY(0)';
            
            setTimeout(() => {
                notification.style.transform = 'translateY(100%)';
            }, 3000);
        }

        // Initialize
        renderThreads();
        updateUnreadCount();

        // Simulate new message
        setTimeout(() => {
            const thread = messagesData[0];
            thread.messages.push({
                sender: 'seller',
                content: 'Your package is out for delivery! You should receive it today.',
                timestamp: new Date()
            });
            thread.lastMessage = 'Your package is out for delivery! You should receive it today.';
            thread.lastMessageTime = new Date();
            thread.unread = 1;
            
            renderThreads();
            updateUnreadCount();
            
            if (selectedThreadId === thread.id) {
                renderMessages(thread);
            }
            
            showNotification('New message from Fashion Hub!');
        }, 10000);
    </script>
</body>
</html>